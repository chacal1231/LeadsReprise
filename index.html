<!doctype html>
<html lang="en" dir="ltr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="msapplication-TileColor" content="#0061da">
	<meta name="theme-color" content="#1643a3">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">

	<!-- Title -->
	<title>Reprise</title>

	<!--Bootstrap.min css-->
	<link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css">

	<!-- Dashboard css -->
	<link href="assets/css/style.css" rel="stylesheet" />

	<!-- Custom scroll bar css-->
	<link href="assets/plugins/scroll-bar/jquery.mCustomScrollbar.css" rel="stylesheet" />

	<!-- Sidemenu css -->
	<link href="assets/plugins/toggle-sidebar/sidemenu.css" rel="stylesheet" />

	<!--Daterangepicker css-->
	<link href="assets/plugins/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet" />

	<!-- Sidebar Accordions css -->
	<link href="assets/plugins/accordion1/css/easy-responsive-tabs.css" rel="stylesheet">

	<!-- Rightsidebar css -->
	<link href="assets/plugins/sidebar/sidebar.css" rel="stylesheet">

	<!-- Morris  Charts css-->
	<link href="assets/plugins/morris/morris.css" rel="stylesheet" />

	<!---Font icons css-->
	<link href="assets/plugins/iconfonts/plugin.css" rel="stylesheet" />
	<link href="assets/plugins/iconfonts/icons.css" rel="stylesheet" />
	<link  href="assets/fonts/fonts/font-awesome.min.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css">
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker-standalone.css">
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/start/jquery-ui.css"/>
</head>

<body class="app sidebar-mini rtl">

	<!--Global-Loader-->
	<div id="global-loader">
		<img src="assets/images/icons/loader.svg" alt="loader">
	</div>

	<div class="page">
		<div class="page-main">
			<!--app-header-->
			<div class="app-header header d-flex">
				<div class="container-fluid">
					<div class="d-flex">
						<a class="header-brand" href="index.html">
							<img src="https://s3.amazonaws.com/picajobs/publications/dise-ador-multimedia-216334f9f1.png" class="header-brand-img main-logo" alt="Hogo logo">
						</a><!-- logo-->
						<a aria-label="Hide Sidebar" class="app-sidebar__toggle" data-toggle="sidebar" href="#"></a>
						<a href="#" data-toggle="search" class="nav-link nav-link  navsearch"><i class="fa fa-search"></i></a><!-- search icon -->
						<div class="header-form">
							<form class="form-inline">
								<div class="search-element mr-3">
									<input class="form-control" type="search" placeholder="Search" aria-label="Search">
									<span class="Search-icon"><i class="fa fa-search"></i></span>
								</div>
							</form><!-- search-bar -->
						</div>
					</div>
				</div>
			</div>
			<!--app-header end-->

			<!-- Sidebar menu-->
			<div class="app-sidebar__overlay" data-toggle="sidebar"></div>
			<aside class="app-sidebar">
				<div class="app-sidebar__user pb-0">
					<div class="user-body">
					</div>
					<div class="user-info">
						<a href="#" class="ml-2"><span class="text-dark app-sidebar__user-name font-weight-semibold">Reprise Digital</span><br>
							<span class="text-muted app-sidebar__user-name text-sm"> IPG</span>
						</a>
					</div>
				</div>

				<div class="tab-menu-heading siderbar-tabs border-0 p-0">
					<div class="tabs-menu ">
						<!-- Tabs -->
						<ul class="nav panel-tabs">
							<li class=""><a href="#index1" class="active" data-toggle="tab"><i class="fa fa-home fs-17"></i></a></li>
						</ul>
					</div>
				</div>
				<div class="panel-body tabs-menu-body side-tab-body p-0 border-0 ">
					<div class="tab-content">
						<div class="tab-pane active " id="index1">
							<div class="row row-demo-list">
								<div id="parentVerticalTab" class="col-md-12">
									<ul class="resp-tabs-list hor_1">
										<li class="resp-tab-active active"><i class="side-menu__icon typcn typcn-device-desktop"></i></li>
									</ul>
									<div class="resp-tabs-container hor_1">
										<div class="resp-tab-content-active">
											<div class="row">
												<div class="col-md-12">
													<h4 class="font-weight-semibold">Home</h4>
													<a class="slide-item" href="index.html">Main</a>
													<a class="slide-item" href="#" onclick="Exportar();">Exportar Leads</a>
													<a class="slide-item" href="#" onclick="Token();">Actualizar token</a>
													<a class="slide-item" href="#" onclick="Formulario();">Agregar formulario</a>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div><!-- col-4 -->
						</div>
					</div>
				</div>
			</aside>
			<!--sidemenu end-->

			<!-- app-content-->
			<div class="app-content  my-3 my-md-5">
				<div class="side-app">
					<div class="row">
						<div class="col-sm-3 col-md-12 col-lg-3 col-xl-3">
							<div class="card">
								<div class="card-body">
									<div class="d-flex clearfix">
										<div class="text-left mt-3">
											<p class="card-text mb-1">Total Leads</p>
											<h2 class="mb-0 text-dark mainvalue" id="LeadsTotales"></h2>
										</div>
										<div class="ml-auto">
											<span class="bg-primary-transparent icon-service text-primary ">
												<i class="si si-briefcase  fs-2"></i>
											</span>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="col-sm-3 col-md-12 col-lg-3 col-xl-3">
							<div class="card">
								<div class="card-body">
									<div class="d-flex clearfix">
										<div class="text-left mt-3">
											<p class="card-text mb-1">Leads hoy</p>
											<h2 class="mb-0 text-dark mainvalue" id="LeadsHoy"></h2>
										</div>
										<div class="ml-auto">
											<span class="bg-success-transparent icon-service text-success">
												<i class="si si-layers fs-2"></i>
											</span>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="col-sm-3 col-md-12 col-lg-3 col-xl-3">
							<div class="card">
								<div class="card-body">
									<div class="d-flex clearfix">
										<div class="text-left mt-3">
											<p class="card-text mb-1">Leads ayer</p>
											<h2 class="mb-0 text-dark mainvalue" id="LeadsAyer"></h2>
										</div>
										<div class="ml-auto">
											<span class="bg-danger-transparent icon-service text-danger">
												<i class="si si-note  fs-2"></i>
											</span>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="col-sm-3 col-md-12 col-lg-3 col-xl-3">
							<div class="card">
								<div class="card-body">
									<div class="d-flex clearfix">
										<div class="text-left mt-3">
											<p class="card-text mb-1">Errores totales</p>
											<h2 class="mb-0 text-dark mainvalue" id="Errores"></h2>
										</div>
										<div class="ml-auto">
											<span class="bg-warning-transparent icon-service text-warning">
												<i class="si si-basket-loaded  fs-2"></i>
											</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="card overflow-hidden">
						<div class="card-header custom-header">
							<div>
								<h4><span class="text-left">Historial</span><br></h4>
							</div>
						</div>
						<div class="card-body">
							<div class="card">
								<div class="card-body">
									<table id="HistorialTabla" class="table table-striped table-bordered nowrap" style="width:100%">
										<thead>
											<tr>
												<th>Formulario</th>
												<th>Estado Descarga</th>
												<th>Estado Carga</th>
												<th>Error</th>
												<th>Fecha descarga</th>
												<th>Fecha consulta</th>
											</tr>
										</thead>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div><!-- End Rightsidebar-->

				<!--footer-->
				<footer class="footer">
					<div class="container">
						<div class="row align-items-center flex-row-reverse">
							<div class="col-lg-12 col-sm-12   text-center">
								Copyright © 2020 <a href="#">Reprise</a>. Designed by <a href="https://www.spruko.com/">DMV</a> All rights reserved.
							</div>
						</div>
					</div>
				</footer>
				<!-- End Footer-->

			</div>
			<!-- End app-content-->
		</div>
	</div>
	<!-- End Page -->

	<!-- Back to top -->
	<a href="#top" id="back-to-top"><i class="fa fa-angle-up"></i></a>

	<!-- Jquery js-->
	<script src="assets/js/vendors/jquery-3.2.1.min.js"></script>

	<!--Bootstrap.min js-->
	<script src="assets/plugins/bootstrap/popper.min.js"></script>
	<script src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>

	<!--Jquery Sparkline js-->
	<script src="assets/js/vendors/jquery.sparkline.min.js"></script>

	<!-- Chart Circle js-->
	<script src="assets/js/vendors/circle-progress.min.js"></script>

	<!-- Star Rating js-->
	<script src="assets/plugins/rating/jquery.rating-stars.js"></script>

	<!--Moment js-->
	<script src="assets/plugins/moment/moment.min.js"></script>

	<!-- Daterangepicker js-->
	<script src="assets/plugins/bootstrap-daterangepicker/daterangepicker.js"></script>

	<!--Side-menu js-->
	<script src="assets/plugins/toggle-sidebar/sidemenu.js"></script>

	<!-- Sidebar Accordions js -->
	<script src="assets/plugins/accordion1/js/easyResponsiveTabs.js"></script>

	<!--Time Counter js-->
	<script src="assets/plugins/counters/jquery.missofis-countdown.js"></script>
	<script src="assets/plugins/counters/counter.js"></script>

	<!-- Custom scroll bar js-->
	<script src="assets/plugins/scroll-bar/jquery.mCustomScrollbar.concat.min.js"></script>

	<!-- Rightsidebar js -->
	<script src="assets/plugins/sidebar/sidebar.js"></script>

	<!-- ECharts js -->
	<script src="assets/plugins/echarts/echarts.js"></script>

	<!--Morris  Charts js-->
	<script src="assets/plugins/morris/raphael-min.js"></script>
	<script src="assets/plugins/morris/morris.js"></script>

	<!-- Custom-charts js-->
	<script src="assets/js/index5.js"></script>

	<!-- Custom js-->
	<script src="assets/js/custom.js"></script>
	<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
</body>
</html>

<style type="text/css">
	.ui-datepicker{z-index: 99999 !important};
</style>

<script type="text/javascript">
	$.ajax({
		type:'GET',
		url:'Api/ConsultarLeads.php',
		dataType: 'json',
		success:function(Response){
			$('#LeadsTotales').html(Response.LeadsTotales);
			$('#LeadsHoy').html(Response.LeadsHoy);
			$('#LeadsAyer').html(Response.LeadsAyer);
			$('#Errores').html(Response.Errores);
		}
	});
	var table=$('#HistorialTabla').DataTable({
		"responsive" : true,
		"order": [[ 0, "desc" ]],
		"bProcessing": false,
		"lengthMenu": [ [10, 20, 25, 50, -1], [10, 20, 25, 50, "All"] ],
		"sAjaxSource": "Api/TablaErrores.php",
		"aoColumns": [
		{ mData: 'IdFormulario' },
		{ mData: 'EstadoDescarga' },
		{ mData: 'EstadoCarga' },
		{ mData: 'Error' },
		{ mData: 'FechaCarga' },
		{ mData: 'FechaConsulta' }
		],
	});
	function Exportar(){
		Swal.fire({
			title: 'Ingrese una fecha:',
			html: '<input id="datepicker" readonly class="swal2-input">',
			customClass: 'swal2-overflow',
			onOpen:function(){
				$('#datepicker').datepicker({
					dateFormat: 'yy-mm-dd',
					container: '#swal2-overflow'
				});
			}
		}).then(function(result) {
			if(result.value){
				window.open('Api/ExportCSV.php?Fecha='+$('#datepicker').val(), '_blank'); 
			}
		});
	}
	/*Procesar Errores*/
	$('#HistorialTabla').on('click', '.Pago', function () {
		data = table.row($(this).closest('tr')).data();
		console.log(data);
		/*Consulto la fecha del último pago*/
		$.ajax({
			type:'GET',
			url:'Api/ConsultarPagos.php',
			data:{'IdCliente': data.IdCliente},
			dataType: 'json',
			success:function(Response){
				$('#UltimoPago').html(Response.FechaUltimoPago);
			}
		});
	});
	function Token(){
		Swal.fire({
			title: 'Ingrese el token de facebook',
			html: '<input id="Token" class="swal2-input">',
			customClass: 'swal2-overflow',
		}).then(function(result) {
			if(result.value){
				if (($('#Token').val()!=="")) {
					Swal.showLoading();
					$.ajax({
						type:'POST',
						url:'Api/ActualizarToken.php',
						data:{'Token': Token},
						dataType: 'json',
						success:function(Response){
							Swal.close();
							if(Response.Estado=="OK"){
								Swal.fire({
									icon: 'success',
									title: '¡Exito!',
									text: '¡Se actualizó correctamente el Token de facebook!'
								})
							}else{
								Swal.fire({
									icon: 'error',
									title: 'Oops...',
									text: Response.Error
								})
							}

						}
					});
				}else{
					Swal.fire({
						icon: 'error',
						title: 'Oops...',
						text: "El token no debe estar vacio"
					})
				}
			}
		});
	}
	function Formulario(){
		Swal.fire({
			title: 'Nuevo formulario',
			html: '<input id="TipoPrograma" placeholder="Tipo de programa" class="swal2-input"><br><input id="NombrePrograma" placeholder="nombre del programa" class="swal2-input"><br><input id="IdFormulario" placeholder="ID del formulario en facebook" class="swal2-input">',
			customClass: 'swal2-overflow',
		}).then(function(result) {
			if(result.value){
				let TipoPrograma = $('#TipoPrograma').val();
				let NombrePrograma = $('#TipoPrograma').val();
				let IdFormulario = $('#IdFormulario').val();
				if(TipoPrograma!=="" || NombrePrograma!=="" || IdFormulario!==""){
					Swal.showLoading()
					$.ajax({
						type:'POST',
						url:'Api/Formularios.php',
						data:{'TipoPrograma': TipoPrograma, 'NombrePrograma':NombrePrograma,'IdFormulario':IdFormulario},
						dataType: 'json',
						success:function(Response){
							Swal.close();
							if(Response.Estado=="OK"){
								Swal.fire({
									icon: 'success',
									title: '¡Exito!',
									text: '¡Se agregó correctamente el formulario de facebook!'
								})
							}else{
								Swal.fire({
									icon: 'error',
									title: 'Oops...',
									text: Response.Error
								})
							}

						}
					});
				}else{
					Swal.fire({
						icon: 'error',
						title: 'Oops...',
						text: "¡Los campos no deben estar vacios!"
					})
				}
			}
		});
	}
</script>